(window.webpackJsonp=window.webpackJsonp||[]).push([[65],{414:function(a,e,t){"use strict";t.r(e);var s=t(25),r=Object(s.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h4",{attrs:{id:"使用准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用准备"}},[a._v("#")]),a._v(" 使用准备")]),a._v(" "),t("ol",[t("li",[a._v("Travis CI 只支持 Github，不支持其他代码托管服务\n"),t("ol",[t("li",[a._v("拥有 GitHub 帐号")]),a._v(" "),t("li",[a._v("该帐号下面有一个项目")]),a._v(" "),t("li",[a._v("该项目里面有可运行的代码")])])]),a._v(" "),t("li",[a._v("访问官方网站 "),t("a",{attrs:{href:"https://travis-ci.org/",target:"_blank",rel:"noopener noreferrer"}},[a._v("travis"),t("OutboundLink")],1),a._v("，使用 Github 账户登入 Travis CI。")]),a._v(" "),t("li",[a._v("Travis 会列出 Github 上面你的所有仓库，以及你所属于的组织。此时，选择你需要 Travis 帮你构建的仓库，打开仓库旁边的开关。一旦激活了一个仓库，Travis 会监听这个仓库的所有变化")])]),a._v(" "),t("h4",{attrs:{id:"配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[a._v("#")]),a._v(" 配置")]),a._v(" "),t("p",[a._v("Travis 要求项目的根目录下面，必须有一个"),t("code",[a._v(".travis.yml")]),a._v("文件。这是配置文件，指定了 Travis 的行为。该文件必须保存在 Github 仓库里面，一旦代码仓库有新的 Commit，Travis 就会去找这个文件，执行里面的命令。")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("language: node_js\nnode_js:\n  - lts/*\nscript:\n  - npm run docs:build\n  - npm run cname\ndeploy:\n  provider: pages\n  # Git项目\n  repo: db117/db117.github.io\n  # 不清理编译文件\n  skip-cleanup: true\n  # 目录\n  local_dir: docs/.vuepress/dist\n  # token\n  github-token: $github\n  keep-history: true\n  # 用token的邮箱用户名提交\n  committer_from_gh: true\n  # 目标分支\n  target_branch: master\n")])])]),t("h4",{attrs:{id:"使用技巧"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用技巧"}},[a._v("#")]),a._v(" 使用技巧")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("环境变量")]),a._v(" "),t("ul",[t("li",[t("p",[t("code",[a._v(".travis.yml")]),a._v("的"),t("code",[a._v("env")]),a._v("字段可以定义环境变量。然后，脚本内部就使用这些变量了。")])]),a._v(" "),t("li",[t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v('env:\n  - DB=postgres\n  - SH=bash\n  - PACKAGE_VERSION="1.0.*"\n')])])])]),a._v(" "),t("li",[t("p",[a._v("有些环境变量（比如用户名和密码）不能公开，这时可以通过 Travis 网站，写在每个仓库的设置页里面，Travis 会自动把它们加入环境变量。这样一来，脚本内部依然可以使用这些环境变量，但是只有管理员才能看到变量的值。具体操作请看"),t("a",{attrs:{href:"https://docs.travis-ci.com/user/environment-variables",target:"_blank",rel:"noopener noreferrer"}},[a._v("官方文档"),t("OutboundLink")],1),a._v("。")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("在使用时用$+变量名")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("github-token: $github\n")])])])])])])])])]),a._v(" "),t("h4",{attrs:{id:"使用travis-client"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用travis-client"}},[a._v("#")]),a._v(" 使用Travis Client")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/travis-ci/travis.rb",target:"_blank",rel:"noopener noreferrer"}},[a._v("文档"),t("OutboundLink")],1)]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("# 安装ruby等依赖\nsudo apt-get install ruby-dev libffi-dev make gcc -y\n# 安装Travis\nsudo gem install travis\n# 查看是否安装成功\ntravis version\n")])])]),t("h4",{attrs:{id:"添加ssh"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#添加ssh"}},[a._v("#")]),a._v(" 添加ssh")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("生成秘钥")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("ssh-keygen -t rsa -b 4096 -C \"<your_email>\" -f <key_name> -N ''\n")])])])]),a._v(" "),t("li",[t("p",[a._v("把公钥放在需要的地方")])]),a._v(" "),t("li",[t("p",[a._v("使用Travis client加密私钥")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("travis encrypt-file <key_name>\n# 找到输出的类似的,放到配置文件中\n")])])])])]),a._v(" "),t("p",[a._v("openssl aes-256-cbc -K $encrypted_XXXXXXXXXXXX_key -iv $encrypted_XXXXXXXXXXXX_iv -in <key_name>.enc -out <key_name> -d")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[a._v("\n- 修改.travis配置文件\n\n")])])]),t("p",[a._v("before_install:")]),a._v(" "),t("ul",[t("li",[a._v("openssl aes-256-cbc -K $encrypted_**********"),t("em",[a._v("key -iv $encrypted")]),a._v("********_iv\n-in .travis/<key_name>.enc -out ~/.ssh/<key_name> -d")]),a._v(" "),t("li",[a._v("chmod 600 ~/.ssh/<key_name>")]),a._v(" "),t("li",[a._v("eval $(ssh-agent)")]),a._v(" "),t("li",[a._v("ssh-add ~/.ssh/<key_name>")])]),a._v(" "),t("h1",{attrs:{id:"最后添加"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#最后添加"}},[a._v("#")]),a._v(" 最后添加")]),a._v(" "),t("p",[a._v("addons:\nssh_known_hosts:\n- github.com")]),a._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code")])])])}),[],!1,null,null,null);e.default=r.exports}}]);